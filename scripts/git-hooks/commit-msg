#!/usr/bin/env bash
# Linta mensagem de commit. Tenta usar commitlint (Node); fallback regex.
set -euo pipefail
MSG_FILE="$1"

if command -v npx >/dev/null 2>&1; then
  npx --yes @commitlint/cli -x @commitlint/config-conventional --edit "$MSG_FILE"
  exit $?
fi

# Fallback bem simples (pode ajustar)
pattern='^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\([^)]+\))?: .+'
if ! grep -qE "$pattern" "$MSG_FILE"; then
  echo "✖ Mensagem fora do padrão Conventional Commits." >&2
  echo "Ex.: feat(api): adiciona healthcheck" >&2
  exit 1
fi
